<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

		<script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
		<script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>

<script>
		AFRAME.registerComponent('loaded', {
			init: function () {
				var el = this.el;
				el.addEventListener('model-loaded', () => {
					console.log(el.id+" chargé");
					});
				this.el.addEventListener('model-error', () => {
						// Grab the mesh / scene.
						console.log("erreur");
					});
				}
		});

		AFRAME.registerComponent('fini', {
			init: function () {
				var el = this.el;
				el.addEventListener('animation-finished', () => {
					console.log(el.id+" fini");
					});
				}
		});
		AFRAME.registerComponent('switch', {
			init: function () {
				var el = this.el;
				var change = 0;
				function getRandomInt(min, max) {
					min = Math.ceil(min);
					max = Math.floor(max);
					return Math.floor(Math.random() * (max - min + 1)) + min;
};
				el.addEventListener('animation-finished', () => {
					change = getRandomInt(1,5);
					console.log(el.id+"switch"+change);


					});
				}
		});
</script>


  </head>

  <body style='margin : 0px; overflow: hidden;'>

		<a-scene background="color: skyblue">
			<a-assets>
				<a-asset-item id="glbModel" src="./models/AntoineActionTexture.glb"></a-asset-item>

			</a-assets>


			#lumières et evironnement
			<a-entity light="type: ambient; color: #CCC; intensity: 0.5"></a-entity>
			<a-entity light="type: directional; castShadow:true; color: red; intensity: 0.5" position="-1 2 1"></a-entity>
			<a-entity environment="preset: yavapai; dressingAmount: 200" shadow="receive: true"></a-entity>


			#personnage (utiliser "pas 01" "pas 02" ou "pas 03")
			<a-entity   id ="Antoine"
						fini
						switch
			      scale="1 1 1"
			      position="0 0 -3"
			      rotation="90 90 0"s
			      loaded
			      animation-mixer="clip : pas_03 ;repetitions : 3; clampWhenFinished: true; duration : 4"
			      gltf-model="#glbModel"
			      shadow="cast:true"
			      shadow="receive: true">
			</a-entity>

			#camera
			<a-entity id="camera" position="0 1.6 0" camera look-controls></a-entity>
    	</a-scene>

  </body>
</html>
